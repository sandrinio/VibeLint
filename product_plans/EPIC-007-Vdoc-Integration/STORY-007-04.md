---
id: STORY-007-04
parent_epic: EPIC-007
status: Draft
actor: Frontend Developer
complexity: Medium (2-3 files)
---
# STORY-007-04: Docs Status Page

## 1. The Spec (The Contract)

### 1.1 User Story
**As a** Frontend Developer,
**I want** a Docs Status page that shows the freshness status of all vdoc documents for a selected repo,
**So that** developers can see at a glance which docs are current and which need refreshing.

### 1.2 Detailed Requirements
- **Requirement 1**: Create `src/client/pages/DocsStatus.tsx` â€” the Docs Status page component.
- **Requirement 2**: Include a repo selector dropdown at the top of the page to choose which repo's docs to display.
- **Requirement 3**: If `hasVdocs` is `false`, show a "No documentation found" message with instructions to run `/vdoc-init` in the user's coding agent.
- **Requirement 4**: If `hasVdocs` is `true`, show a table with columns: Document (title), Status (fresh/stale badge), Last Updated (formatted date).
- **Requirement 5**: Show a summary bar above the table: "X docs fresh, Y docs stale".
- **Requirement 6**: Stale documents show a warning icon with a tooltip or inline text: "Source files changed since doc was generated".
- **Requirement 7**: Include instructions text: "Use `/vdoc-update` in your coding agent to refresh stale docs".

---

## 2. The Truth (Executable Tests)

### 2.1 Acceptance Criteria (Gherkin)
```gherkin
Feature: Docs Status Page

  Scenario: No vdocs found
    Given a repo with hasVdocs=false
    When I open the Docs Status page and select that repo
    Then the page shows "No documentation found"
    And instructions to run "/vdoc-init" are displayed
    And no table is rendered

  Scenario: All docs fresh
    Given a repo with 3 fresh documents
    When I open the Docs Status page and select that repo
    Then the summary bar shows "3 docs fresh, 0 docs stale"
    And the table shows 3 rows
    And each row has a green "Fresh" badge

  Scenario: Mixed freshness
    Given a repo with 2 fresh docs and 1 stale doc
    When I open the Docs Status page and select that repo
    Then the summary bar shows "2 docs fresh, 1 doc stale"
    And the stale doc row has an amber "Stale" badge
    And the stale doc row shows a warning icon
    And instructions to use "/vdoc-update" are shown

  Scenario: Unknown status docs
    Given a repo with 1 unknown status doc
    When I open the Docs Status page
    Then the unknown doc row has a gray "Unknown" badge
    And the staleReason text is displayed inline or as tooltip

  Scenario: Repo selector changes data
    Given two repos are connected, "my-app" and "api-service"
    When I select "api-service" from the repo dropdown
    Then the page fetches docs status for "api-service"
    And the table updates to show api-service's documents

  Scenario: Loading state
    Given the page is fetching docs status
    Then a loading indicator is shown
    And the table is not rendered until data arrives

  Scenario: Last updated formatting
    Given a document with lastUpdated "2026-02-20T14:30:00Z"
    Then the table shows "Feb 20, 2026" or a relative time like "3 days ago"
```

### 2.2 Verification Steps
- [ ] Docs Status page renders at the correct route.
- [ ] Repo selector dropdown lists all connected repos.
- [ ] "No documentation found" message appears when `hasVdocs` is false.
- [ ] `/vdoc-init` instructions appear when no docs exist.
- [ ] Summary bar accurately shows fresh and stale counts.
- [ ] Table renders document title, status badge, and last updated date.
- [ ] Stale documents have warning icon and explanation text.
- [ ] `/vdoc-update` instructions appear when stale docs exist.
- [ ] Selecting a different repo fetches and displays that repo's docs.
- [ ] Loading and error states are handled.

---

## 3. The Implementation Guide (AI-to-AI)

### 3.1 Context & Files
- **Primary Files**: `src/client/pages/DocsStatus.tsx`
- **Related Files**: `src/client/lib/api.ts` (add docs status API function), `src/client/App.tsx` (add route)
- **New Files Needed**:
  - `src/client/pages/DocsStatus.tsx`

### 3.2 Technical Logic

**Step 1: Add API function in `src/client/lib/api.ts`**

```typescript
/** Response from GET /api/repos/:repoId/docs */
export interface DocsStatusResponse {
  hasVdocs: boolean;
  documents: Array<{
    title: string;
    filename: string;
    status: 'fresh' | 'stale' | 'unknown';
    lastUpdated: string;
    staleReason?: string;
  }>;
  summary: {
    total: number;
    fresh: number;
    stale: number;
    unknown: number;
  };
}

/** Fetch docs status for a repo */
export async function fetchDocsStatus(
  repoId: string
): Promise<DocsStatusResponse> {
  const res = await fetch(`${API_BASE}/repos/${repoId}/docs`);
  if (!res.ok) {
    const body = await res.json().catch(() => ({}));
    throw new Error(body.error ?? `Failed: ${res.status}`);
  }
  return res.json();
}

/** Fetch all repos (assumes this exists from EPIC-002) */
export async function fetchRepos(): Promise<
  Array<{ id: string; name: string; path: string; platform: string }>
> {
  const res = await fetch(`${API_BASE}/repos`);
  if (!res.ok) throw new Error('Failed to fetch repos');
  return res.json();
}
```

**Step 2: Implement `DocsStatus.tsx`**

```tsx
import React, { useState, useEffect } from 'react';
import { fetchRepos, fetchDocsStatus } from '../lib/api';
import type { DocsStatusResponse } from '../lib/api';

export function DocsStatus() {
  const [repos, setRepos] = useState<
    Array<{ id: string; name: string }>
  >([]);
  const [selectedRepoId, setSelectedRepoId] = useState<string>('');
  const [docsStatus, setDocsStatus] =
    useState<DocsStatusResponse | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Load repos on mount
  useEffect(() => {
    fetchRepos().then((data) => {
      setRepos(data);
      if (data.length > 0) {
        setSelectedRepoId(data[0].id);
      }
    });
  }, []);

  // Fetch docs status when selected repo changes
  useEffect(() => {
    if (!selectedRepoId) return;

    setIsLoading(true);
    setError(null);
    fetchDocsStatus(selectedRepoId)
      .then((data) => setDocsStatus(data))
      .catch((err) =>
        setError(err instanceof Error ? err.message : 'Unknown error')
      )
      .finally(() => setIsLoading(false));
  }, [selectedRepoId]);

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">Documentation Status</h1>

      {/* Repo selector */}
      <div className="mb-6">
        <label
          htmlFor="repo-select"
          className="block text-sm font-medium text-gray-700 mb-1"
        >
          Repository
        </label>
        <select
          id="repo-select"
          value={selectedRepoId}
          onChange={(e) => setSelectedRepoId(e.target.value)}
          className="w-full max-w-xs border border-gray-300 rounded px-3 py-2 text-sm"
        >
          {repos.map((repo) => (
            <option key={repo.id} value={repo.id}>
              {repo.name}
            </option>
          ))}
        </select>
      </div>

      {/* Loading state */}
      {isLoading && (
        <div className="text-gray-500 py-8 text-center">
          Loading documentation status...
        </div>
      )}

      {/* Error state */}
      {error && (
        <div className="bg-red-50 text-red-700 border border-red-200 rounded p-4 mb-4">
          {error}
        </div>
      )}

      {/* No vdocs found */}
      {!isLoading && docsStatus && !docsStatus.hasVdocs && (
        <NoDocsMessage />
      )}

      {/* Docs table */}
      {!isLoading && docsStatus && docsStatus.hasVdocs && (
        <DocsTable docsStatus={docsStatus} />
      )}
    </div>
  );
}

/** Message shown when no vdocs exist */
function NoDocsMessage() {
  return (
    <div className="bg-gray-50 border border-gray-200 rounded-lg p-8 text-center">
      <div className="text-gray-400 text-4xl mb-4">&#128196;</div>
      <h2 className="text-lg font-semibold text-gray-700 mb-2">
        No documentation found
      </h2>
      <p className="text-gray-500 mb-4">
        This repository does not have a <code>vdocs/</code> directory.
      </p>
      <div className="bg-white border rounded p-4 text-left max-w-md mx-auto">
        <p className="text-sm text-gray-600 mb-2">
          To generate documentation, use the{' '}
          <code className="bg-gray-100 px-1 rounded">/vdoc-init</code>{' '}
          command in your coding agent:
        </p>
        <pre className="bg-gray-100 p-2 rounded text-sm font-mono">
          /vdoc-init
        </pre>
      </div>
    </div>
  );
}

/** Table showing docs with freshness status */
function DocsTable({
  docsStatus,
}: {
  docsStatus: DocsStatusResponse;
}) {
  const { documents, summary } = docsStatus;

  return (
    <div>
      {/* Summary bar */}
      <div className="flex items-center gap-4 mb-4 text-sm">
        <span className="text-green-700 font-medium">
          {summary.fresh} doc{summary.fresh !== 1 ? 's' : ''} fresh
        </span>
        {summary.stale > 0 && (
          <span className="text-amber-700 font-medium">
            {summary.stale} doc{summary.stale !== 1 ? 's' : ''} stale
          </span>
        )}
        {summary.unknown > 0 && (
          <span className="text-gray-500 font-medium">
            {summary.unknown} unknown
          </span>
        )}
      </div>

      {/* Documents table */}
      <div className="border rounded-lg overflow-hidden">
        <table className="w-full text-sm">
          <thead className="bg-gray-50">
            <tr>
              <th className="text-left px-4 py-3 font-medium text-gray-700">
                Document
              </th>
              <th className="text-left px-4 py-3 font-medium text-gray-700">
                Status
              </th>
              <th className="text-left px-4 py-3 font-medium text-gray-700">
                Last Updated
              </th>
            </tr>
          </thead>
          <tbody className="divide-y">
            {documents.map((doc) => (
              <tr key={doc.filename} className="hover:bg-gray-50">
                <td className="px-4 py-3">
                  <div className="font-medium">{doc.title}</div>
                  <div className="text-xs text-gray-400 font-mono">
                    vdocs/{doc.filename}
                  </div>
                </td>
                <td className="px-4 py-3">
                  <StatusBadge status={doc.status} />
                  {doc.staleReason && (
                    <div className="text-xs text-gray-500 mt-1">
                      {doc.staleReason}
                    </div>
                  )}
                </td>
                <td className="px-4 py-3 text-gray-600">
                  {formatDate(doc.lastUpdated)}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Instructions for stale docs */}
      {summary.stale > 0 && (
        <div className="mt-4 bg-amber-50 border border-amber-200 rounded p-4 text-sm text-amber-800">
          <p>
            <strong>Stale docs detected.</strong> Source files have
            changed since these documents were generated.
          </p>
          <p className="mt-1">
            Use{' '}
            <code className="bg-amber-100 px-1 rounded">
              /vdoc-update
            </code>{' '}
            in your coding agent to refresh stale docs.
          </p>
        </div>
      )}
    </div>
  );
}

/** Badge component for fresh/stale/unknown status */
function StatusBadge({
  status,
}: {
  status: 'fresh' | 'stale' | 'unknown';
}) {
  const styles = {
    fresh: 'bg-green-100 text-green-700',
    stale: 'bg-amber-100 text-amber-700',
    unknown: 'bg-gray-100 text-gray-600',
  };

  const icons = {
    fresh: '\u2713', // checkmark
    stale: '\u26A0', // warning triangle
    unknown: '?',
  };

  return (
    <span
      className={`inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full font-medium ${styles[status]}`}
    >
      <span>{icons[status]}</span>
      {status.charAt(0).toUpperCase() + status.slice(1)}
    </span>
  );
}

/** Format an ISO date string for display */
function formatDate(isoString: string): string {
  try {
    const date = new Date(isoString);
    return date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    });
  } catch {
    return isoString;
  }
}
```

**Step 3: Register the route in `App.tsx`**

```tsx
import { DocsStatus } from './pages/DocsStatus';

// Inside the router:
<Route path="/docs" element={<DocsStatus />} />
```

**Step 4: Add navigation link**

Ensure the top navigation bar includes a "Docs" link pointing to `/docs`. This is typically in a shared `Layout` or `NavBar` component:

```tsx
<NavLink to="/docs">Docs</NavLink>
```

### 3.3 API Contract
This story consumes the API defined in STORY-007-03:

| Method | Path | Purpose |
|--------|------|---------|
| `GET` | `/api/repos/:repoId/docs` | Fetch documentation freshness status |
| `GET` | `/api/repos` | Fetch list of repos for the selector |

---

## 4. Definition of Done (The Gate)
- [ ] `src/client/pages/DocsStatus.tsx` renders the Docs Status page.
- [ ] Repo selector dropdown lists all connected repos and fetches data on selection.
- [ ] "No documentation found" message with `/vdoc-init` instructions appears when `hasVdocs` is false.
- [ ] Summary bar shows "X docs fresh, Y docs stale" counts.
- [ ] Table displays document title, status badge (fresh/stale/unknown), and formatted last updated date.
- [ ] Stale documents show warning icon and staleReason text.
- [ ] `/vdoc-update` instructions appear below the table when stale docs exist.
- [ ] Loading state is shown while fetching data.
- [ ] Error state is displayed if the API call fails.
- [ ] Route is registered in `App.tsx` and navigation link is added.
- [ ] `src/client/lib/api.ts` includes `fetchDocsStatus` and `fetchRepos` functions.
- [ ] TypeScript compiles with no errors (`npx tsc --noEmit`).

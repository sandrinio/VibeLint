# EPIC-007: vdoc Integration

## Metadata
| Field | Value |
|-------|-------|
| **Status** | Draft |
| **Ambiguity** | Low |
| **Context Source** | [PRD v4](../PRD.md) — Sprint 4: PR Navigation + vdoc |
| **Owner** | Engineering |
| **Priority** | P2 - Medium |
| **Tags** | #vdoc, #documentation, #freshness, #monitoring |
| **Target Date** | TBD |

---

## 1. Problem & Value
> Target Audience: Stakeholders, Business Sponsors

### 1.1 The Problem
Feature documentation generated by vdoc goes stale as source code changes. Developers have no visibility into which docs are current and which need refreshing. Without freshness monitoring, docs drift out of sync silently, leading to inaccurate AI context.

### 1.2 The Solution
A documentation monitoring system that checks `vdocs/` for freshness by comparing doc timestamps to source file modification times. The dashboard Docs Status page shows fresh/stale indicators, and slash commands (`/vdoc-init`, `/vdoc-update`) are prepared for the AI agent to generate or refresh docs.

### 1.3 Success Metrics (North Star)
- Dashboard accurately shows fresh/stale status for each vdoc document
- Stale docs are flagged with clear indication of what changed
- Users know to run `/vdoc-init` or `/vdoc-update` from the dashboard
- vdoc monitor detects new/updated vdoc files automatically

---

## 2. Scope Boundaries
> Target Audience: AI Agents (Critical for preventing hallucinations)

### IN-SCOPE (Build This)
- [ ] vdoc freshness monitor (`src/server/vdoc/monitor.ts`) — compare timestamps
- [ ] Parse `vdocs/_manifest.json` for document metadata
- [ ] REST API: docs status endpoint (`src/server/api/docs.ts`)
- [ ] Frontend: Docs Status page (`src/client/pages/DocsStatus.tsx`)
- [ ] Show fresh/stale indicators with "last updated" timestamps
- [ ] Show instructions for `/vdoc-init` and `/vdoc-update` when docs missing/stale

### OUT-OF-SCOPE (Do NOT Build This)
- Running vdoc itself (done by the AI coding agent via slash commands)
- Generating documentation content
- Editing vdoc files in the dashboard
- vdoc configuration or template management

---

## 3. Context

### 3.1 User Personas
- **Developer**: Wants to know if project docs are current before using them
- **AI Agent**: Reads vdoc files as context; stale docs lead to bad suggestions
- **New Team Member**: Uses docs to onboard; stale docs cause confusion

### 3.2 Constraints
| Type | Constraint |
|------|------------|
| **Read-only** | VibeLint only monitors vdocs, never writes them |
| **Freshness** | Staleness = source files changed after doc was last modified |
| **Manifest** | Depends on `vdocs/_manifest.json` existing (created by vdoc) |
| **No vdoc runtime** | VibeLint doesn't run vdoc — the coding agent does via `/vdoc-init` |

---

## 4. Technical Context
> Target Audience: AI Agents — READ THIS before decomposing.

### 4.1 Affected Areas
| Area | Files/Modules | Change Type |
|------|---------------|-------------|
| vdoc monitor | `src/server/vdoc/monitor.ts` | Create |
| Docs API | `src/server/api/docs.ts` | Create |
| Docs Status UI | `src/client/pages/DocsStatus.tsx` | Create |
| API client | `src/client/lib/api.ts` | Modify (add docs endpoint) |

### 4.2 Dependencies
| Type | Dependency | Status |
|------|------------|--------|
| **Requires** | EPIC-001 (Server) | Must be complete |
| **Requires** | EPIC-002 (Repos connected) | Must be complete |
| **Optional** | vdoc installed and `vdocs/` exists in repo | User-dependent |

### 4.3 Integration Points
| System | Purpose | Notes |
|--------|---------|-------|
| `vdocs/_manifest.json` | Document metadata (title, source files, last generated) | Read-only |
| `vdocs/*.md` | Document files | Check modification times |
| Source files | Compare timestamps for freshness | `fs.stat` |
| Filesystem watcher | Detect vdoc file changes | Optional (polling fallback) |

---

## 5. Decomposition Guidance
> Hints for AI story breakdown. Check all that apply.

- [ ] **Schema/Migration** - No schema changes
- [x] **API Work** - Docs status endpoint
- [x] **UI Work** - Docs Status page
- [x] **Integration** - Filesystem monitoring, manifest parsing
- [ ] **Bug Fixes** - Greenfield
- [ ] **Hygiene** - N/A
- [ ] **Testing** - Freshness calculation tests with mock timestamps

### Suggested Story Sequence
1. **STORY-007-01**: vdoc manifest parser — read `_manifest.json`, extract metadata
2. **STORY-007-02**: Freshness monitor — compare doc timestamps to source file timestamps
3. **STORY-007-03**: REST API — docs status endpoint
4. **STORY-007-04**: Frontend — Docs Status page (table with fresh/stale indicators)

---

## 6. Risks & Edge Cases
| Risk | Likelihood | Mitigation |
|------|------------|------------|
| `vdocs/` doesn't exist in repo | High | Show "No documentation found" with `/vdoc-init` instructions |
| `_manifest.json` missing or malformed | Medium | Handle gracefully, show what we can from file listing |
| Source files referenced in manifest were renamed/deleted | Low | Show "unknown" freshness, flag for attention |
| Large number of docs (50+) | Low | Paginate the docs table |

---

## 7. Acceptance Criteria (Epic-Level)
> How do we know the EPIC is complete? Full user flow.

```gherkin
Feature: vdoc Integration

  Scenario: Docs exist and are fresh
    Given vdocs/ contains PROJECT_OVERVIEW.md
    And no source files have changed since it was generated
    When the user opens the Docs Status page
    Then PROJECT_OVERVIEW shows status "Fresh" with last updated timestamp

  Scenario: Docs exist but are stale
    Given vdocs/ contains AUTHENTICATION.md
    And source files referenced by it have changed since generation
    When the user opens the Docs Status page
    Then AUTHENTICATION shows status "Stale"

  Scenario: No vdocs directory
    Given the repo has no vdocs/ directory
    When the user opens the Docs Status page
    Then a message says "No documentation found"
    And instructions to run /vdoc-init are shown

  Scenario: Docs refreshed
    Given AUTHENTICATION was stale
    When the user runs /vdoc-update in their coding agent
    And the agent regenerates the doc
    Then the Docs Status page shows AUTHENTICATION as "Fresh"
```

---

## 8. Open Questions
| Question | Options | Impact | Owner | Status |
|----------|---------|--------|-------|--------|
| How to determine source files for each doc? | A: Read from `_manifest.json`, B: Heuristic (grep imports in doc) | Freshness accuracy | Eng | Leaning A |
| Poll for changes or use filesystem watcher? | A: Poll on page load, B: `fs.watch` (live updates) | UX responsiveness | Eng | Leaning A |

---

## 9. Artifact Links
> Auto-populated as Epic is decomposed.

**Stories:**
- [ ] STORY-007-01: vdoc Manifest Parser
- [ ] STORY-007-02: Freshness Monitor
- [ ] STORY-007-03: Docs Status API
- [ ] STORY-007-04: Docs Status Page

**References:**
- PRD: [PRD.md](../PRD.md)
- PRD vdoc Flow: PRD.md lines 569-591
- PRD Docs Dashboard: PRD.md lines 396-421
- PRD Sprint 4: PRD.md lines 832-846

---
id: STORY-008-04
parent_epic: EPIC-008
status: Draft
actor: Frontend Developer
complexity: Medium (2-3 files)
---
# STORY-008-04: TrendChart Component

## 1. The Spec (The Contract)

### 1.1 User Story
**As a** Frontend Developer,
**I want** a reusable TrendChart component that renders line charts from time-series metric data using Recharts,
**So that** the Trends page can display historical metric charts for each tracked metric.

### 1.2 Detailed Requirements
- **Requirement 1**: Create `src/client/components/TrendChart.tsx` that renders a responsive line chart using the Recharts library.
- **Requirement 2**: Accept props: `data` (array of `{timestamp: string, value: number | null}`), `label` (chart title), `color` (line color hex code), `unit` (value unit suffix like `%`, `files`, `lines`).
- **Requirement 3**: X-axis displays dates formatted as short dates (e.g., "Feb 1", "Feb 15"). Y-axis shows metric values with appropriate scaling.
- **Requirement 4**: Display a hover tooltip showing the exact date and value when the user hovers over data points.
- **Requirement 5**: The chart must be responsive — resize to fill its container width, with a fixed height of 200px.
- **Requirement 6**: Optional area fill under the line (controlled by an `areaFill` boolean prop, default `true`).
- **Requirement 7**: Handle empty data (0 points) by showing a "No data" placeholder instead of an empty chart. Handle single data points by showing just the dot.
- **Requirement 8**: Install `recharts` as a project dependency.

---

## 2. The Truth (Executable Tests)

### 2.1 Acceptance Criteria (Gherkin)
```gherkin
Feature: TrendChart Component

  Scenario: Render a line chart with data
    Given data with 5 entries spanning Feb 1 to Feb 23
    When the TrendChart renders
    Then a line chart is displayed with 5 data points
    And the X-axis shows date labels
    And the Y-axis shows value labels

  Scenario: Hover tooltip
    Given the chart is rendered with data
    When the user hovers over a data point
    Then a tooltip appears showing the date and exact value with unit

  Scenario: Responsive sizing
    Given the chart container is 400px wide
    When the component renders
    Then the chart fills the full 400px width
    And the chart height is 200px

  Scenario: Area fill
    Given the areaFill prop is true
    When the chart renders
    Then a gradient fill appears under the line

  Scenario: No area fill
    Given the areaFill prop is false
    When the chart renders
    Then no fill appears under the line — only the line is drawn

  Scenario: Empty data
    Given data is an empty array
    When the TrendChart renders
    Then it shows a "No data" message instead of a chart

  Scenario: Single data point
    Given data has exactly 1 entry
    When the TrendChart renders
    Then a single dot is displayed at the correct position

  Scenario: Null values in data
    Given data has some entries with value: null
    When the TrendChart renders
    Then the line skips null points (gaps in the line)
```

### 2.2 Verification Steps
- [ ] Line chart renders with correct number of data points.
- [ ] X-axis shows formatted dates (short month + day).
- [ ] Y-axis shows metric values with appropriate range.
- [ ] Hover tooltip displays date and value with unit suffix.
- [ ] Chart is responsive and fills container width.
- [ ] Area fill renders when `areaFill` is true.
- [ ] "No data" placeholder shown for empty data arrays.
- [ ] Null values create gaps in the line chart.
- [ ] `recharts` dependency is installed.

---

## 3. The Implementation Guide (AI-to-AI)

### 3.1 Context & Files
- **Primary Files**: `src/client/components/TrendChart.tsx` (create)
- **Related Files**:
  - `src/client/pages/Trends.tsx` (STORY-008-05 — consumes this component)
  - `package.json` (add `recharts` dependency)
- **New Files Needed**:
  - `src/client/components/TrendChart.tsx`

### 3.2 Technical Logic

**Step 1: Install Recharts**

```bash
npm install recharts
```

Recharts provides React-native chart components: `LineChart`, `Line`, `XAxis`, `YAxis`, `CartesianGrid`, `Tooltip`, `ResponsiveContainer`, `Area`, `AreaChart`.

**Step 2: Define component props**

```typescript
// src/client/components/TrendChart.tsx

import React from 'react';
import {
  ResponsiveContainer,
  AreaChart,
  Area,
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  TooltipProps,
} from 'recharts';

interface DataPoint {
  timestamp: string;
  value: number | null;
}

interface TrendChartProps {
  data: DataPoint[];
  label: string;
  color: string;          // Hex color, e.g. "#3b82f6"
  unit?: string;          // Value unit suffix, e.g. "%", "files"
  areaFill?: boolean;     // Fill under line (default: true)
}
```

**Step 3: Format data for Recharts**

```typescript
function formatChartData(data: DataPoint[]) {
  return data.map(d => ({
    date: new Date(d.timestamp).getTime(),  // numeric for proper scaling
    displayDate: formatShortDate(d.timestamp),
    value: d.value,
  }));
}

function formatShortDate(isoDate: string): string {
  const date = new Date(isoDate);
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}
```

**Step 4: Build custom tooltip**

```typescript
function CustomTooltip({
  active,
  payload,
  unit,
}: TooltipProps<number, string> & { unit?: string }) {
  if (!active || !payload || payload.length === 0) return null;

  const data = payload[0];
  const date = data.payload?.displayDate;
  const value = data.value;

  return (
    <div className="bg-white border rounded shadow-lg px-3 py-2 text-sm">
      <div className="text-gray-500 text-xs">{date}</div>
      <div className="font-semibold">
        {value !== null && value !== undefined
          ? `${value}${unit ? ` ${unit}` : ''}`
          : 'N/A'}
      </div>
    </div>
  );
}
```

**Step 5: Build the main TrendChart component**

```tsx
export default function TrendChart({
  data,
  label,
  color,
  unit = '',
  areaFill = true,
}: TrendChartProps) {
  // Empty state
  if (data.length === 0) {
    return (
      <div className="h-[200px] flex items-center justify-center text-gray-400 text-sm border rounded">
        No data
      </div>
    );
  }

  const chartData = formatChartData(data);

  // Generate a lighter version of the color for area fill
  const fillColor = `${color}20`; // 20 = ~12% opacity in hex

  return (
    <div>
      <h3 className="text-sm font-medium text-gray-700 mb-2">{label}</h3>
      <ResponsiveContainer width="100%" height={200}>
        {areaFill ? (
          <AreaChart data={chartData} margin={{ top: 5, right: 10, left: 0, bottom: 5 }}>
            <defs>
              <linearGradient id={`gradient-${label}`} x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={color} stopOpacity={0.3} />
                <stop offset="100%" stopColor={color} stopOpacity={0.0} />
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
            <XAxis
              dataKey="displayDate"
              tick={{ fontSize: 11, fill: '#9ca3af' }}
              tickLine={false}
              axisLine={{ stroke: '#e5e7eb' }}
            />
            <YAxis
              tick={{ fontSize: 11, fill: '#9ca3af' }}
              tickLine={false}
              axisLine={false}
              width={45}
            />
            <Tooltip
              content={<CustomTooltip unit={unit} />}
            />
            <Area
              type="monotone"
              dataKey="value"
              stroke={color}
              strokeWidth={2}
              fill={`url(#gradient-${label})`}
              dot={{ r: 3, fill: color, stroke: '#fff', strokeWidth: 2 }}
              activeDot={{ r: 5, fill: color, stroke: '#fff', strokeWidth: 2 }}
              connectNulls={false}
            />
          </AreaChart>
        ) : (
          <LineChart data={chartData} margin={{ top: 5, right: 10, left: 0, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
            <XAxis
              dataKey="displayDate"
              tick={{ fontSize: 11, fill: '#9ca3af' }}
              tickLine={false}
              axisLine={{ stroke: '#e5e7eb' }}
            />
            <YAxis
              tick={{ fontSize: 11, fill: '#9ca3af' }}
              tickLine={false}
              axisLine={false}
              width={45}
            />
            <Tooltip
              content={<CustomTooltip unit={unit} />}
            />
            <Line
              type="monotone"
              dataKey="value"
              stroke={color}
              strokeWidth={2}
              dot={{ r: 3, fill: color, stroke: '#fff', strokeWidth: 2 }}
              activeDot={{ r: 5, fill: color, stroke: '#fff', strokeWidth: 2 }}
              connectNulls={false}
            />
          </LineChart>
        )}
      </ResponsiveContainer>
    </div>
  );
}
```

**Step 6: Install and verify Recharts dependency**

Add to `package.json` dependencies:
```json
{
  "dependencies": {
    "recharts": "^2.12.0"
  }
}
```

Then install:
```bash
npm install recharts
```

Note: Recharts depends on `react` and `react-dom` which are already installed (EPIC-001).

### 3.3 API Contract
N/A — this is a presentational component. It receives data via props; it does not make API calls directly.

---

## 4. Definition of Done (The Gate)
- [ ] `src/client/components/TrendChart.tsx` exists and exports a default React component.
- [ ] `recharts` is installed as a production dependency in `package.json`.
- [ ] Component renders a responsive line/area chart from `DataPoint[]` data.
- [ ] X-axis displays formatted short dates; Y-axis displays metric values.
- [ ] Hover tooltip shows date and value with unit suffix.
- [ ] Chart is responsive (fills container width, 200px height).
- [ ] Area fill renders when `areaFill` is true; line-only when false.
- [ ] "No data" placeholder shown for empty data arrays.
- [ ] Null values create gaps in the chart line.
- [ ] No TypeScript compilation errors (`npx tsc --noEmit`).
- [ ] No console errors when rendering the component.

---
id: STORY-002-06
parent_epic: EPIC-002
status: Draft
actor: Frontend Developer
complexity: Medium (2-3 files)
---
# STORY-002-06: Dashboard Home with Repo Cards

## 1. The Spec (The Contract)

### 1.1 User Story
**As a** Frontend Developer,
**I want** a Dashboard page that displays repo cards for each connected repository with key metadata and quick actions,
**So that** users have an at-a-glance overview of their connected repositories and can quickly access common operations.

### 1.2 Detailed Requirements
- **Requirement 1**: Create `src/client/pages/Dashboard.tsx` as the main dashboard page.
- **Requirement 2**: If the setup wizard has not been completed (check `GET /api/setup/status`), redirect the user to `/setup`.
- **Requirement 3**: If no repos are connected, show a prominent "Add a repository" call-to-action linking to `/setup` (or an inline repo adder).
- **Requirement 4**: Display a card for each connected repo (fetched from `GET /api/repos`).
- **Requirement 5**: Each `RepoCard` shows: repo name, path (truncated), language badges, current branch (if available from last scan), last scan timestamp (formatted relative or absolute), and quick action buttons.
- **Requirement 6**: Quick action buttons: "Run Analysis" (disabled, tooltip "Coming in EPIC-005") and "Re-inject" (disabled, tooltip "Coming in EPIC-004").
- **Requirement 7**: Create `src/client/components/RepoCard.tsx` as a reusable card component.
- **Requirement 8**: Dashboard should display a simple header with "Your Repositories" title and repo count.

---

## 2. The Truth (Executable Tests)

### 2.1 Acceptance Criteria (Gherkin)
```gherkin
Feature: Dashboard Home with Repo Cards

  Scenario: Redirect to setup wizard if not completed
    Given the wizard has not been completed
    When the user navigates to /
    Then they are redirected to /setup

  Scenario: Show empty state when no repos
    Given the wizard is completed
    And no repos are connected
    When the user navigates to /
    Then a "Add a repository" call-to-action is displayed

  Scenario: Display repo cards
    Given the wizard is completed
    And 2 repos are connected
    When the user navigates to /
    Then 2 RepoCard components are rendered
    And each card shows the repo name, path, and language badges

  Scenario: Quick actions are disabled
    Given a repo card is displayed
    Then the "Run Analysis" button is disabled
    And it shows a tooltip "Coming in EPIC-005"
    And the "Re-inject" button is disabled
    And it shows a tooltip "Coming in EPIC-004"

  Scenario: Language badges are rendered
    Given a repo has languages ["TypeScript", "Python", "CSS"]
    When its card is rendered
    Then 3 language badges are visible with the correct labels

  Scenario: Last scan time is displayed
    Given a repo was last scanned at "2026-02-20T10:30:00Z"
    When its card is rendered
    Then the card shows a human-readable scan time (e.g., "3 days ago" or "Feb 20, 2026")
```

### 2.2 Verification Steps
- [ ] Navigating to `/` when wizard is incomplete redirects to `/setup`.
- [ ] Navigating to `/` when wizard is complete shows the Dashboard.
- [ ] If no repos exist, the empty state CTA is shown.
- [ ] If repos exist, each repo is displayed as a card.
- [ ] Repo cards show name, path, language badges, and last scan time.
- [ ] "Run Analysis" and "Re-inject" buttons are present but disabled.
- [ ] Dashboard header shows "Your Repositories" with a count.

---

## 3. The Implementation Guide (AI-to-AI)

### 3.1 Context & Files
- **Primary Files**:
  - `src/client/pages/Dashboard.tsx`
  - `src/client/components/RepoCard.tsx`
- **Related Files**:
  - `src/client/lib/api.ts` (from STORY-002-05, provides `fetchRepos`, `fetchSetupStatus`)
  - `src/client/App.tsx` (route already exists from STORY-001-02)
- **New Files Needed**: Yes â€” both primary files

### 3.2 Technical Logic

**Step 1: Create a time formatting utility**

Add to `src/client/lib/api.ts` or create `src/client/lib/format.ts`:

```typescript
/**
 * Format an ISO timestamp as a relative or absolute time string.
 */
export function formatTime(isoString: string | null): string {
  if (!isoString) return 'Never';

  const date = new Date(isoString);
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffMinutes = Math.floor(diffMs / 60_000);
  const diffHours = Math.floor(diffMs / 3_600_000);
  const diffDays = Math.floor(diffMs / 86_400_000);

  if (diffMinutes < 1) return 'Just now';
  if (diffMinutes < 60) return `${diffMinutes}m ago`;
  if (diffHours < 24) return `${diffHours}h ago`;
  if (diffDays < 7) return `${diffDays}d ago`;

  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric',
  });
}
```

**Step 2: Create `src/client/components/RepoCard.tsx`**

```tsx
import React from 'react';
import type { RepoResponse } from '../lib/api';
import { formatTime } from '../lib/format';

interface RepoCardProps {
  repo: RepoResponse;
}

export default function RepoCard({ repo }: RepoCardProps) {
  return (
    <div className="border border-gray-200 rounded-lg p-5 bg-white shadow-sm hover:shadow-md transition-shadow">
      {/* Header */}
      <div className="flex items-start justify-between mb-3">
        <div>
          <h3 className="text-lg font-semibold text-gray-900">{repo.name}</h3>
          <p className="text-sm text-gray-400 truncate max-w-xs" title={repo.path}>
            {repo.path}
          </p>
        </div>
        {repo.scan?.currentBranch && (
          <span className="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded font-mono">
            {repo.scan.currentBranch}
          </span>
        )}
      </div>

      {/* Language Badges */}
      <div className="flex flex-wrap gap-1.5 mb-4">
        {repo.languages.map((lang) => (
          <span
            key={lang}
            className="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded"
          >
            {lang}
          </span>
        ))}
        {repo.languages.length === 0 && (
          <span className="text-xs text-gray-400">No languages detected</span>
        )}
      </div>

      {/* Existing Context Files (if scan data available) */}
      {repo.scan?.existingFiles && (
        <div className="flex flex-wrap gap-1.5 mb-4">
          {Object.entries(repo.scan.existingFiles)
            .filter(([, exists]) => exists)
            .map(([file]) => (
              <span
                key={file}
                className="text-xs bg-green-50 text-green-700 px-2 py-0.5 rounded"
              >
                {file}
              </span>
            ))}
        </div>
      )}

      {/* Footer */}
      <div className="flex items-center justify-between pt-3 border-t border-gray-100">
        <span className="text-xs text-gray-400">
          Scanned: {formatTime(repo.last_scan_at)}
        </span>
        <div className="flex gap-2">
          <button
            disabled
            title="Coming in EPIC-005"
            className="text-xs px-3 py-1.5 border border-gray-200 rounded text-gray-400 cursor-not-allowed"
          >
            Run Analysis
          </button>
          <button
            disabled
            title="Coming in EPIC-004"
            className="text-xs px-3 py-1.5 border border-gray-200 rounded text-gray-400 cursor-not-allowed"
          >
            Re-inject
          </button>
        </div>
      </div>
    </div>
  );
}
```

**Step 3: Create `src/client/pages/Dashboard.tsx`**

```tsx
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import RepoCard from '../components/RepoCard';
import { fetchRepos, fetchSetupStatus, type RepoResponse } from '../lib/api';

export default function Dashboard() {
  const navigate = useNavigate();
  const [repos, setRepos] = useState<RepoResponse[]>([]);
  const [loading, setLoading] = useState(true);
  const [setupChecked, setSetupChecked] = useState(false);

  useEffect(() => {
    // Check if wizard is completed
    fetchSetupStatus().then((status) => {
      if (!status.completed) {
        navigate('/setup', { replace: true });
        return;
      }
      setSetupChecked(true);

      // Fetch repos
      fetchRepos()
        .then(setRepos)
        .finally(() => setLoading(false));
    });
  }, [navigate]);

  // Don't render until setup check is done
  if (!setupChecked) {
    return (
      <div className="flex items-center justify-center h-64">
        <p className="text-gray-400">Loading...</p>
      </div>
    );
  }

  return (
    <div className="max-w-5xl mx-auto">
      {/* Header */}
      <div className="flex items-center justify-between mb-6">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Your Repositories</h1>
          <p className="text-sm text-gray-500">
            {repos.length} {repos.length === 1 ? 'repository' : 'repositories'} connected
          </p>
        </div>
      </div>

      {/* Loading state */}
      {loading && (
        <div className="flex items-center justify-center h-48">
          <p className="text-gray-400">Loading repositories...</p>
        </div>
      )}

      {/* Empty state */}
      {!loading && repos.length === 0 && (
        <div className="text-center py-16 border-2 border-dashed border-gray-200 rounded-lg">
          <h2 className="text-lg font-medium text-gray-600 mb-2">No repositories connected</h2>
          <p className="text-gray-400 mb-6">
            Connect a repository to start generating AI context files.
          </p>
          <button
            onClick={() => navigate('/setup')}
            className="bg-brand-500 text-white px-6 py-2 rounded text-sm hover:bg-brand-600"
          >
            Add a Repository
          </button>
        </div>
      )}

      {/* Repo Grid */}
      {!loading && repos.length > 0 && (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {repos.map((repo) => (
            <RepoCard key={repo.id} repo={repo} />
          ))}
        </div>
      )}
    </div>
  );
}
```

**Step 4: Update `src/client/App.tsx` route**

Replace the placeholder `Dashboard` import with the real component:

```tsx
import Dashboard from './pages/Dashboard';
// ... in Routes:
<Route path="/" element={<Dashboard />} />
```

**Step 5: Create `src/client/lib/format.ts`**

(The `formatTime` utility shown in Step 1.)

### 3.3 API Contract

This story consumes the following API endpoints:

| Method | Path                | Purpose                          |
|--------|---------------------|----------------------------------|
| GET    | `/api/setup/status` | Check if wizard is completed     |
| GET    | `/api/repos`        | Fetch all connected repositories |

---

## 4. Definition of Done (The Gate)
- [ ] `src/client/pages/Dashboard.tsx` exists and renders the dashboard.
- [ ] `src/client/components/RepoCard.tsx` exists and renders individual repo cards.
- [ ] `src/client/lib/format.ts` exists with time formatting utility.
- [ ] Dashboard redirects to `/setup` if wizard is not completed.
- [ ] Empty state shows "Add a repository" CTA when no repos exist.
- [ ] Repo cards display: name, path, language badges, last scan time.
- [ ] "Run Analysis" button is disabled with tooltip "Coming in EPIC-005".
- [ ] "Re-inject" button is disabled with tooltip "Coming in EPIC-004".
- [ ] Dashboard header shows repo count.
- [ ] Grid layout renders responsively (1 column on small screens, 2 on medium+).
- [ ] No TypeScript or React compilation errors.

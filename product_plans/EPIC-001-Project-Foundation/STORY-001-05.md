---
id: STORY-001-05
parent_epic: EPIC-001
status: Draft
actor: Full-Stack Developer
complexity: Low (1 file)
---
# STORY-001-05: CLI Entry Point

## 1. The Spec (The Contract)

### 1.1 User Story
**As a** Full-Stack Developer,
**I want** a CLI entry point (`vibelint` command) that starts the Fastify server and opens the browser,
**So that** developers can launch VibeLint with a single command and immediately see the web UI.

### 1.2 Detailed Requirements
- **Requirement 1**: Create `bin/vibelint.ts` as the CLI entry script.
- **Requirement 2**: Import `startServer` from `src/server/index.ts` and call it.
- **Requirement 3**: Use the `open` npm package to launch `http://localhost:<port>` in the user's default browser after the server is listening.
- **Requirement 4**: Parse `--port <number>` flag (default: 3847).
- **Requirement 5**: Parse `--no-open` flag to skip opening the browser.
- **Requirement 6**: Print a startup message to stdout: `"VibeLint running at http://localhost:<port>"`.
- **Requirement 7**: Ensure `package.json` has `"bin": { "vibelint": "./bin/vibelint.ts" }` and the bin entry works via `npx tsx bin/vibelint.ts` during development.

---

## 2. The Truth (Executable Tests)

### 2.1 Acceptance Criteria (Gherkin)
```gherkin
Feature: CLI Entry Point

  Scenario: Default startup
    Given no flags are passed
    When I run "npx tsx bin/vibelint.ts"
    Then the server starts on port 3847
    And the message "VibeLint running at http://localhost:3847" is printed
    And the default browser opens to http://localhost:3847

  Scenario: Custom port
    Given the flag "--port 4000" is passed
    When I run "npx tsx bin/vibelint.ts --port 4000"
    Then the server starts on port 4000
    And the message "VibeLint running at http://localhost:4000" is printed

  Scenario: No-open flag
    Given the flag "--no-open" is passed
    When I run "npx tsx bin/vibelint.ts --no-open"
    Then the server starts on port 3847
    And the browser is NOT opened
    And the startup message is still printed

  Scenario: Combined flags
    Given both "--port 5000" and "--no-open" are passed
    When I run "npx tsx bin/vibelint.ts --port 5000 --no-open"
    Then the server starts on port 5000
    And the browser is NOT opened
```

### 2.2 Verification Steps
- [ ] `npx tsx bin/vibelint.ts --no-open` starts the server and prints the startup message.
- [ ] `curl http://localhost:3847/api/health` responds successfully while the server is running.
- [ ] `npx tsx bin/vibelint.ts --port 4000 --no-open` starts on port 4000.
- [ ] `npx tsx bin/vibelint.ts` (without `--no-open`) opens the browser (manual verification).

---

## 3. The Implementation Guide (AI-to-AI)

### 3.1 Context & Files
- **Primary Files**: `bin/vibelint.ts`
- **Related Files**: `src/server/index.ts` (STORY-001-03), `package.json` (STORY-001-01)
- **New Files Needed**: Yes — `bin/vibelint.ts`

### 3.2 Technical Logic

**Step 1: Create `bin/vibelint.ts`**

```typescript
#!/usr/bin/env npx tsx

import { startServer } from '../src/server/index.js';
import open from 'open';

// --- Argument Parsing ---

function parseArgs(argv: string[]): { port: number; noOpen: boolean } {
  let port = 3847;
  let noOpen = false;

  for (let i = 2; i < argv.length; i++) {
    const arg = argv[i];
    if (arg === '--port' && argv[i + 1]) {
      const parsed = parseInt(argv[i + 1], 10);
      if (!isNaN(parsed) && parsed > 0 && parsed < 65536) {
        port = parsed;
      }
      i++; // skip next arg (the port number)
    } else if (arg === '--no-open') {
      noOpen = true;
    }
  }

  return { port, noOpen };
}

// --- Main ---

async function main(): Promise<void> {
  const { port, noOpen } = parseArgs(process.argv);

  try {
    await startServer({ port });

    const url = `http://localhost:${port}`;
    console.log(`\nVibeLint running at ${url}\n`);

    if (!noOpen) {
      await open(url);
    }
  } catch (error) {
    console.error('Failed to start VibeLint:', error);
    process.exit(1);
  }
}

main();
```

**Step 2: Ensure `package.json` bin entry is correct**

The `package.json` from STORY-001-01 should already have:

```json
{
  "bin": {
    "vibelint": "./bin/vibelint.ts"
  }
}
```

For local development, the script is invoked via `npx tsx bin/vibelint.ts`. For global installation, a wrapper or `tsx` shim would be needed (future concern).

**Step 3: Make the file executable (for Unix systems)**

```bash
chmod +x bin/vibelint.ts
```

**Step 4: Verify the dev script in `package.json`**

Ensure the `"dev"` script works:

```json
{
  "scripts": {
    "dev": "tsx watch bin/vibelint.ts --no-open"
  }
}
```

The `--no-open` flag on the dev script prevents the browser from reopening on every file-watch restart.

### 3.3 API Contract
N/A — this is a CLI entry point, not an API.

---

## 4. Definition of Done (The Gate)
- [ ] `bin/vibelint.ts` exists and is executable.
- [ ] Running `npx tsx bin/vibelint.ts --no-open` starts the server and prints `"VibeLint running at http://localhost:3847"`.
- [ ] The `--port` flag correctly changes the listening port.
- [ ] The `--no-open` flag prevents browser launch.
- [ ] Without `--no-open`, the default browser opens to the correct URL.
- [ ] `package.json` has the correct `bin` entry.
- [ ] `npm run dev` starts the server in watch mode.

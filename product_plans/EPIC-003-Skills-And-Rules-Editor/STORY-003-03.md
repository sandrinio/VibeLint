---
id: STORY-003-03
parent_epic: EPIC-003
status: Draft
actor: Full-Stack Developer
complexity: High (4+ files)
---
# STORY-003-03: Rule & Command Templates

## 1. The Spec (The Contract)

### 1.1 User Story
**As a** Full-Stack Developer,
**I want** default template files for platform rules (CLAUDE.md, .cursorrules, .windsurfrules, AGENTS.md), slash commands (review, check, health, vdoc-init, vdoc-update), and config files (config.yml, LESSONS.md),
**So that** users get a complete, ready-to-customize set of context files for their AI coding platform without writing any from scratch.

### 1.2 Detailed Requirements
- **Requirement 1**: Create rule templates in `templates/rules/`:
  - `claude-code/CLAUDE.md.template` — CLAUDE.md with placeholders (`{{PROJECT_NAME}}`, `{{SKILL_REFS}}`, `{{LESSONS_REF}}`) for project name, skill file references, and LESSONS.md reference
  - `cursor/cursorrules.template` — .cursorrules equivalent with same placeholder pattern
  - `windsurf/windsurfrules.template` — .windsurfrules equivalent
  - `generic/AGENTS.md.template` — generic agent rules file
- **Requirement 2**: Create command templates in `templates/commands/claude-code/`:
  - `review.md` — /review: read analysis report, review code changes, reference skills
  - `check.md` — /check: run pre-commit quality checks
  - `health.md` — /health: read reports, summarize codebase health
  - `vdoc-init.md` — /vdoc-init: explore codebase, propose doc plan, generate docs
  - `vdoc-update.md` — /vdoc-update: check stale docs, refresh them
- **Requirement 3**: Create config templates in `templates/config/`:
  - `config.yml.template` — analysis thresholds (complexity, duplication, file size limits)
  - `LESSONS.md.template` — starter LESSONS.md with sections for gotchas, patterns, decisions
- **Requirement 4**: Rule templates use `{{PLACEHOLDER}}` syntax for values that the injector (EPIC-004) will replace at injection time. Commands are plain markdown with no placeholders.
- **Requirement 5**: Each slash command template follows the pattern: purpose description, step-by-step instructions for the AI agent, file paths to reference, and expected output format.
- **Requirement 6**: All files are read-only defaults. Users override them per-repo via the Rules and Commands APIs (STORY-003-05, STORY-003-06).

---

## 2. The Truth (Executable Tests)

### 2.1 Acceptance Criteria (Gherkin)
```gherkin
Feature: Rule and Command Templates

  Scenario: All rule templates exist
    Given the templates/rules/ directory structure
    When I list files recursively
    Then the following files exist:
      | path                                 |
      | claude-code/CLAUDE.md.template       |
      | cursor/cursorrules.template          |
      | windsurf/windsurfrules.template      |
      | generic/AGENTS.md.template           |

  Scenario: Rule templates contain placeholders
    Given the file templates/rules/claude-code/CLAUDE.md.template
    When I read its content
    Then it contains "{{PROJECT_NAME}}"
    And it contains "{{SKILL_REFS}}"
    And it contains "{{LESSONS_REF}}"

  Scenario: All command templates exist
    Given the templates/commands/claude-code/ directory
    When I list its contents
    Then it contains: review.md, check.md, health.md, vdoc-init.md, vdoc-update.md

  Scenario: Command templates contain agent instructions
    Given a command template file
    When I read its content
    Then it starts with a heading describing the command purpose
    And it contains step-by-step instructions for the AI agent

  Scenario: Config templates exist
    Given the templates/config/ directory
    When I list its contents
    Then it contains: config.yml.template, LESSONS.md.template

  Scenario: config.yml template has analysis thresholds
    Given the file templates/config/config.yml.template
    When I read its content
    Then it contains threshold settings for complexity, duplication, and file size

  Scenario: Template loader reads all rule categories
    Given all rule template files exist
    When I call listTemplates("rules/claude-code")
    Then it returns 1 result
    When I call listTemplates("commands/claude-code")
    Then it returns 5 results
    When I call listTemplates("config")
    Then it returns 2 results
```

### 2.2 Verification Steps
- [ ] `templates/rules/claude-code/CLAUDE.md.template` exists and contains `{{PROJECT_NAME}}`, `{{SKILL_REFS}}`, `{{LESSONS_REF}}`.
- [ ] `templates/rules/cursor/cursorrules.template` exists and contains equivalent placeholders.
- [ ] `templates/rules/windsurf/windsurfrules.template` exists and contains equivalent placeholders.
- [ ] `templates/rules/generic/AGENTS.md.template` exists.
- [ ] `templates/commands/claude-code/` contains 5 `.md` files (review, check, health, vdoc-init, vdoc-update).
- [ ] `templates/config/config.yml.template` contains YAML with analysis thresholds.
- [ ] `templates/config/LESSONS.md.template` contains section headings for gotchas, patterns, decisions.
- [ ] `listTemplates` from STORY-003-01 can read all new template categories.
- [ ] All files are valid markdown (or valid YAML for config.yml.template).

---

## 3. The Implementation Guide (AI-to-AI)

### 3.1 Context & Files
- **Primary Files**: 11 new template files across `templates/rules/`, `templates/commands/`, and `templates/config/`
- **Related Files**: `src/server/templates/loader.ts` (STORY-003-01, reads these files)
- **New Files Needed**:
  - `templates/rules/claude-code/CLAUDE.md.template`
  - `templates/rules/cursor/cursorrules.template`
  - `templates/rules/windsurf/windsurfrules.template`
  - `templates/rules/generic/AGENTS.md.template`
  - `templates/commands/claude-code/review.md`
  - `templates/commands/claude-code/check.md`
  - `templates/commands/claude-code/health.md`
  - `templates/commands/claude-code/vdoc-init.md`
  - `templates/commands/claude-code/vdoc-update.md`
  - `templates/config/config.yml.template`
  - `templates/config/LESSONS.md.template`

### 3.2 Technical Logic

**Placeholder Convention**: Rule templates use `{{PLACEHOLDER}}` syntax. The injector (EPIC-004, not this story) will perform string replacement at injection time. Supported placeholders:

| Placeholder | Replaced With |
|-------------|---------------|
| `{{PROJECT_NAME}}` | Repository name from `repos.name` |
| `{{SKILL_REFS}}` | Bullet list of `.vibelint/skills/*.md` paths for active skills |
| `{{LESSONS_REF}}` | Path to `LESSONS.md` |
| `{{REPORTS_REF}}` | Path to `.vibelint/reports/latest.md` |
| `{{COMMANDS_REF}}` | List of available slash commands |

---

**File 1: `templates/rules/claude-code/CLAUDE.md.template`**

Structure (approximately 50-70 lines):

```markdown
# {{PROJECT_NAME}} — Project Rules

## Skills

Read and follow these skill files for coding guidelines:
{{SKILL_REFS}}

## Lessons Learned

Read {{LESSONS_REF}} for project-specific lessons, gotchas, and decisions.
Update it when you discover new patterns or pitfalls.

## Analysis Reports

Before code reviews, read {{REPORTS_REF}} for the latest analysis data
including complexity metrics, duplication findings, and error handling patterns.

## Project Architecture

[Describe your project's architecture here. VibeLint provides this placeholder
for you to fill in with your specific project structure.]

- Source code: `src/`
- Tests: `tests/`
- Configuration: project root

## Coding Standards

- Follow the skill files listed above for language-specific patterns
- Write tests for all new functionality
- Keep functions under 40 lines
- Keep files under 300 lines
- Handle all errors explicitly — never swallow exceptions

## Git Workflow

- Write clear, descriptive commit messages
- Keep commits focused on a single logical change
- Reference issue numbers in commits when applicable
```

**File 2: `templates/rules/cursor/cursorrules.template`**

Similar structure adapted for Cursor's `.cursorrules` format. Cursor reads this file automatically. Same placeholders. Content adapted: references `.vibelint/skills/` directly, uses Cursor-specific conventions (no slash command references since Cursor uses different command system).

**File 3: `templates/rules/windsurf/windsurfrules.template`**

Similar structure adapted for Windsurf's `.windsurfrules` format. Same placeholder pattern.

**File 4: `templates/rules/generic/AGENTS.md.template`**

Generic version using `AGENTS.md` convention. References skill files and reports. Neutral language (not tied to any specific AI tool).

---

**File 5: `templates/commands/claude-code/review.md`**

Structure (approximately 30-50 lines):

```markdown
# Code Review

Review the current code changes using analysis data and project skills.

## Steps

1. Read the analysis report at `.vibelint/reports/latest.md` for metrics data
2. Read the skill files in `.vibelint/skills/` for coding guidelines
3. Read `LESSONS.md` for project-specific patterns and gotchas
4. Review the staged or recent changes against these guidelines
5. Check for:
   - Complexity increases flagged in the analysis report
   - Code duplication (new clones)
   - Error handling gaps
   - Naming and structure violations per the skill files
   - Missing or inadequate tests
6. Provide specific, actionable feedback organized by file
7. Rate overall quality: PASS / WARN / FAIL with justification

## Output Format

Organize your review by file, with specific line references where possible.
Start with a summary, then detail findings per file.
End with a list of required changes (if any) and suggested improvements.
```

**File 6: `templates/commands/claude-code/check.md`**

```markdown
# Pre-Commit Quality Check

Run quality checks on the current changes before committing.

## Steps

1. Identify all files that have been modified (staged or unstaged)
2. For each modified file, check against the relevant skill guidelines in `.vibelint/skills/`
3. Verify:
   - No functions exceed 40 lines
   - No files exceed 300 lines
   - All error handling is explicit (no empty catch blocks, no ignored errors)
   - Naming conventions are followed
   - New code has corresponding tests
4. Read `.vibelint/config.yml` for project-specific thresholds
5. Report results as a checklist: PASS or FAIL per check

## Output Format

Return a checklist summary. If all checks pass, confirm ready to commit.
If any fail, list the specific issues that need fixing before committing.
```

**File 7: `templates/commands/claude-code/health.md`**

```markdown
# Codebase Health Summary

Summarize the overall health of the codebase using analysis reports.

## Steps

1. Read `.vibelint/reports/latest.md` for the most recent analysis data
2. Read `LESSONS.md` for known issues and patterns
3. Summarize key metrics:
   - Overall complexity trend (improving or degrading)
   - Duplication level
   - Error handling coverage
   - File size distribution
   - Dependency health
4. Identify the top 3 areas needing attention
5. Suggest concrete next steps for improvement

## Output Format

Provide a brief executive summary (3-5 sentences), then a metrics table,
then prioritized recommendations. Keep it concise and actionable.
```

**File 8: `templates/commands/claude-code/vdoc-init.md`**

```markdown
# Initialize Documentation (vdoc)

Explore the codebase and generate feature-centric documentation.

## Steps

1. Explore the project structure: read the main entry points, directory layout, and key modules
2. Identify the major features/domains in the codebase
3. Propose a documentation plan listing each feature document to generate
4. Wait for user approval of the plan
5. For each approved feature document:
   a. Read all relevant source files
   b. Write a comprehensive feature document explaining purpose, architecture, key files, data flow, and usage
   c. Save to `vdocs/{feature-name}.md`
6. Create `vdocs/_manifest.json` listing all generated documents with timestamps
7. Create `vdocs/PROJECT_OVERVIEW.md` as the top-level summary

## Output Format

Each document should be self-contained, readable by a developer new to the project.
Include file references, architecture diagrams (as ASCII), and key code patterns.
```

**File 9: `templates/commands/claude-code/vdoc-update.md`**

```markdown
# Update Stale Documentation (vdoc)

Check for stale documentation and refresh it.

## Steps

1. Read `vdocs/_manifest.json` for the list of existing documents and their timestamps
2. For each document, check if source files referenced in it have been modified since the document was last generated
3. List stale documents and summarize what changed
4. For each stale document:
   a. Re-read the relevant source files
   b. Update the document to reflect current code
   c. Update the timestamp in `_manifest.json`
5. Report which documents were updated and which remain current

## Output Format

Start with a summary of stale vs. fresh documents.
For each updated document, briefly describe what changed.
```

---

**File 10: `templates/config/config.yml.template`**

```yaml
# VibeLint Configuration
# Analysis thresholds and project settings

analysis:
  # Complexity thresholds (cyclomatic complexity per function)
  complexity:
    warn: 10        # Flag functions with complexity >= 10
    fail: 20        # Fail functions with complexity >= 20

  # Code duplication thresholds
  duplication:
    min_lines: 10   # Minimum clone size to detect (lines)
    min_tokens: 50  # Minimum clone size to detect (tokens)
    warn: 3         # Flag if >= 3 duplicated blocks found
    fail: 10        # Fail if >= 10 duplicated blocks found

  # File size thresholds (lines of code)
  file_size:
    warn: 300       # Flag files with > 300 lines
    fail: 500       # Fail files with > 500 lines

  # Function size thresholds (lines)
  function_size:
    warn: 40        # Flag functions with > 40 lines
    fail: 80        # Fail functions with > 80 lines

  # Error handling
  error_handling:
    flag_empty_catch: true      # Flag empty catch/except blocks
    flag_generic_catch: true    # Flag catch-all exception handlers

# Skills to include (file names from templates/skills/)
skills:
  - general.md
  # Add language-specific skills below:
  # - typescript.md
  # - python.md
  # - go.md

# Project metadata (used in template placeholders)
project:
  name: "{{PROJECT_NAME}}"
```

**File 11: `templates/config/LESSONS.md.template`**

```markdown
# Lessons Learned — {{PROJECT_NAME}}

A living document of project-specific knowledge. Update this as you discover
new patterns, gotchas, and architectural decisions.

## Gotchas

Things that are surprising or counterintuitive in this codebase:

- [Add gotchas as you discover them]

## Patterns

Established patterns and conventions specific to this project:

- [Add patterns as they emerge]

## Architectural Decisions

Key decisions and the reasoning behind them:

- [Document decisions with context and trade-offs]

## Dependencies

Notes about third-party dependencies, quirks, and version constraints:

- [Add dependency notes here]

## Environment & Setup

Special setup steps, environment variables, or configuration needed:

- [Document setup requirements]
```

### 3.3 API Contract
N/A — these are static template files read by the template loader (STORY-003-01) and served by the APIs (STORY-003-04/05/06).

---

## 4. Definition of Done (The Gate)
- [ ] `templates/rules/claude-code/CLAUDE.md.template` exists with `{{PROJECT_NAME}}`, `{{SKILL_REFS}}`, `{{LESSONS_REF}}` placeholders.
- [ ] `templates/rules/cursor/cursorrules.template` exists with equivalent placeholders.
- [ ] `templates/rules/windsurf/windsurfrules.template` exists with equivalent placeholders.
- [ ] `templates/rules/generic/AGENTS.md.template` exists with equivalent placeholders.
- [ ] `templates/commands/claude-code/` contains 5 `.md` files: review.md, check.md, health.md, vdoc-init.md, vdoc-update.md.
- [ ] Each command template contains a purpose heading, step-by-step instructions, and output format.
- [ ] `templates/config/config.yml.template` contains valid YAML with analysis threshold settings.
- [ ] `templates/config/LESSONS.md.template` contains section headings for gotchas, patterns, decisions, dependencies, environment.
- [ ] `listTemplates("rules/claude-code")` returns 1 result, `listTemplates("commands/claude-code")` returns 5, `listTemplates("config")` returns 2.
- [ ] All template files are valid markdown (or YAML for config.yml.template).

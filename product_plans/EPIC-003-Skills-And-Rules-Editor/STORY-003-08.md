---
id: STORY-003-08
parent_epic: EPIC-003
status: Done
actor: Frontend Developer
complexity: Medium (2-3 files)
---
# STORY-003-08: Skills Editor Page

## 1. The Spec (The Contract)

### 1.1 User Story
**As a** Frontend Developer,
**I want** a Skills Editor page where users can browse, view, edit, create, and reset coding skill files for a selected repository,
**So that** users can customize the AI coding guidelines that will be injected into their repos.

### 1.2 Detailed Requirements
- **Requirement 1**: Create `src/client/pages/SkillsEditor.tsx` as a routable page component.
- **Requirement 2**: Include a repo selector dropdown at the top of the page, populated from connected repos (`GET /api/repos`). The selected repo determines which skills are loaded.
- **Requirement 3**: Left sidebar displays a list of skills grouped into two sections: "Built-in Skills" (defaults) and "Custom Skills" (user-created). Each entry shows the skill name and a modified indicator (dot or icon) if it differs from the default.
- **Requirement 4**: Clicking a skill in the sidebar loads its content into the main area's MarkdownEditor component.
- **Requirement 5**: Main area contains the MarkdownEditor (from STORY-003-07) with buttons: "Save", "Reset to Default" (only for built-in skills), and a "Preview" toggle.
- **Requirement 6**: A "+ Create New Skill" button opens a dialog/modal where the user enters a skill name. On confirm, it creates a new custom skill via `POST /api/repos/:repoId/skills` and selects it for editing.
- **Requirement 7**: Skills are loaded from `GET /api/repos/:repoId/skills`. Save calls `PUT /api/repos/:repoId/skills/:name`. Reset calls `POST /api/repos/:repoId/skills/:name/reset`. Delete custom skills via `DELETE /api/repos/:repoId/skills/:name`.
- **Requirement 8**: Show a toast or inline notification on save success/failure.
- **Requirement 9**: If no repo is selected or no repos exist, show an empty state with instructions to connect a repo first.

---

## 2. The Truth (Executable Tests)

### 2.1 Acceptance Criteria (Gherkin)
```gherkin
Feature: Skills Editor Page

  Background:
    Given at least one repo is connected
    And the Skills Editor page is loaded

  Scenario: Repo selector shows connected repos
    When I open the repo selector dropdown
    Then it lists all connected repos by name
    And the first repo is selected by default

  Scenario: Skills list loads for selected repo
    Given a repo is selected
    When the skills list loads
    Then the sidebar shows built-in skills (general.md, typescript.md, etc.)
    And custom skills are shown in a separate "Custom Skills" section

  Scenario: Select a skill to edit
    Given the skills list is loaded
    When I click on "typescript.md" in the sidebar
    Then the MarkdownEditor loads the content of typescript.md
    And the skill name is displayed above the editor

  Scenario: Edit and save a skill
    Given "general.md" is selected and loaded in the editor
    When I modify the content
    And I click "Save"
    Then a PUT request is sent to /api/repos/:repoId/skills/general.md
    And a success notification is shown
    And the "general.md" entry in the sidebar shows a modified indicator

  Scenario: Reset a built-in skill to default
    Given "general.md" has been modified
    When I click "Reset to Default"
    Then a POST request is sent to /api/repos/:repoId/skills/general.md/reset
    And the editor content reverts to the default template
    And the modified indicator is removed

  Scenario: Create a new custom skill
    When I click "+ Create New Skill"
    Then a dialog appears with a name input field
    When I enter "my-project-rules.md" and confirm
    Then a POST request creates the skill
    And the new skill appears under "Custom Skills" in the sidebar
    And it is selected for editing with empty content

  Scenario: Delete a custom skill
    Given a custom skill "my-project-rules.md" exists
    When I click the delete icon on "my-project-rules.md"
    Then a confirmation dialog appears
    When I confirm deletion
    Then a DELETE request removes the skill
    And it disappears from the sidebar

  Scenario: Preview mode shows rendered markdown
    Given a skill is loaded in the editor
    When I click "Preview"
    Then the rendered markdown preview is displayed

  Scenario: No repos connected shows empty state
    Given no repos are connected
    When I navigate to the Skills Editor
    Then an empty state message is shown with instructions to connect a repo
```

### 2.2 Verification Steps
- [ ] Repo selector dropdown populates from `GET /api/repos`.
- [ ] Selecting a repo loads skills from `GET /api/repos/:repoId/skills`.
- [ ] Sidebar groups skills into "Built-in Skills" and "Custom Skills".
- [ ] Clicking a skill loads it into the MarkdownEditor.
- [ ] Save button calls `PUT` and shows success notification.
- [ ] Reset button calls `POST .../reset` and reverts content.
- [ ] "+ Create New Skill" dialog creates a new skill via `POST`.
- [ ] Delete removes custom skills via `DELETE`.
- [ ] Modified indicator appears when a built-in skill is customized.
- [ ] Preview mode renders markdown via FilePreview.
- [ ] Empty state shows when no repos are connected.
- [ ] TypeScript compiles with no errors.

---

## 3. The Implementation Guide (AI-to-AI)

### 3.1 Context & Files
- **Primary Files**: `src/client/pages/SkillsEditor.tsx` (create)
- **Related Files**:
  - `src/client/components/MarkdownEditor.tsx` (STORY-003-07)
  - `src/client/components/FilePreview.tsx` (STORY-003-07)
  - `src/client/components/EditorWithPreview.tsx` (STORY-003-07)
  - `src/client/lib/api.ts` (existing, modify to add skill API functions)
  - `src/client/App.tsx` (existing, add route)
- **New Files Needed**:
  - `src/client/pages/SkillsEditor.tsx`

### 3.2 Technical Logic

**Step 1: Add API client functions**

Add to `src/client/lib/api.ts`:

```typescript
// Skill types matching the backend response
export interface SkillResponse {
  name: string;
  category: string;
  content: string;
  isDefault: boolean;
  isModified: boolean;
}

// Skill API functions
export async function fetchSkills(repoId: string): Promise<SkillResponse[]> {
  const res = await fetch(`/api/repos/${repoId}/skills`);
  if (!res.ok) throw new Error(`Failed to fetch skills: ${res.statusText}`);
  return res.json();
}

export async function fetchSkill(repoId: string, name: string): Promise<SkillResponse> {
  const res = await fetch(`/api/repos/${repoId}/skills/${encodeURIComponent(name)}`);
  if (!res.ok) throw new Error(`Failed to fetch skill: ${res.statusText}`);
  return res.json();
}

export async function saveSkill(repoId: string, name: string, content: string): Promise<void> {
  const res = await fetch(`/api/repos/${repoId}/skills/${encodeURIComponent(name)}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ content }),
  });
  if (!res.ok) throw new Error(`Failed to save skill: ${res.statusText}`);
}

export async function createSkill(repoId: string, name: string, content: string): Promise<void> {
  const res = await fetch(`/api/repos/${repoId}/skills`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, content }),
  });
  if (!res.ok) {
    if (res.status === 409) throw new Error('A skill with that name already exists');
    throw new Error(`Failed to create skill: ${res.statusText}`);
  }
}

export async function deleteSkill(repoId: string, name: string): Promise<void> {
  const res = await fetch(`/api/repos/${repoId}/skills/${encodeURIComponent(name)}`, {
    method: 'DELETE',
  });
  if (!res.ok) throw new Error(`Failed to delete skill: ${res.statusText}`);
}

export async function resetSkill(repoId: string, name: string): Promise<SkillResponse> {
  const res = await fetch(`/api/repos/${repoId}/skills/${encodeURIComponent(name)}/reset`, {
    method: 'POST',
  });
  if (!res.ok) throw new Error(`Failed to reset skill: ${res.statusText}`);
  return res.json();
}
```

**Step 2: Implement the SkillsEditor page**

```tsx
// src/client/pages/SkillsEditor.tsx

import React, { useState, useEffect, useCallback } from 'react';
import { EditorWithPreview } from '../components/EditorWithPreview.js';
import {
  fetchSkills,
  saveSkill,
  createSkill,
  deleteSkill,
  resetSkill,
  SkillResponse,
} from '../lib/api.js';

// Assumes a useRepos() hook or similar exists from EPIC-002 to get connected repos
// import { useRepos } from '../lib/hooks.js';

interface Repo {
  id: string;
  name: string;
  platform: string;
}

export const SkillsEditor: React.FC = () => {
  // State
  const [repos, setRepos] = useState<Repo[]>([]);
  const [selectedRepoId, setSelectedRepoId] = useState<string>('');
  const [skills, setSkills] = useState<SkillResponse[]>([]);
  const [selectedSkill, setSelectedSkill] = useState<SkillResponse | null>(null);
  const [editorContent, setEditorContent] = useState<string>('');
  const [isDirty, setIsDirty] = useState(false);
  const [notification, setNotification] = useState<{ type: 'success' | 'error'; message: string } | null>(null);
  const [showCreateDialog, setShowCreateDialog] = useState(false);
  const [newSkillName, setNewSkillName] = useState('');

  // Load repos on mount
  useEffect(() => {
    fetch('/api/repos')
      .then((res) => res.json())
      .then((data: Repo[]) => {
        setRepos(data);
        if (data.length > 0) setSelectedRepoId(data[0].id);
      });
  }, []);

  // Load skills when repo changes
  useEffect(() => {
    if (!selectedRepoId) return;
    fetchSkills(selectedRepoId).then((data) => {
      setSkills(data);
      setSelectedSkill(null);
      setEditorContent('');
      setIsDirty(false);
    });
  }, [selectedRepoId]);

  // Select a skill
  const handleSelectSkill = useCallback((skill: SkillResponse) => {
    setSelectedSkill(skill);
    setEditorContent(skill.content);
    setIsDirty(false);
  }, []);

  // Editor content change
  const handleEditorChange = useCallback((value: string) => {
    setEditorContent(value);
    setIsDirty(true);
  }, []);

  // Save
  const handleSave = useCallback(async () => {
    if (!selectedRepoId || !selectedSkill) return;
    try {
      await saveSkill(selectedRepoId, selectedSkill.name, editorContent);
      setNotification({ type: 'success', message: 'Skill saved successfully' });
      setIsDirty(false);
      // Refresh skills list to update modified indicators
      const updated = await fetchSkills(selectedRepoId);
      setSkills(updated);
      // Update selected skill
      const refreshed = updated.find((s) => s.name === selectedSkill.name);
      if (refreshed) setSelectedSkill(refreshed);
    } catch (err) {
      setNotification({ type: 'error', message: (err as Error).message });
    }
  }, [selectedRepoId, selectedSkill, editorContent]);

  // Reset to default
  const handleReset = useCallback(async () => {
    if (!selectedRepoId || !selectedSkill) return;
    try {
      const resetResult = await resetSkill(selectedRepoId, selectedSkill.name);
      setEditorContent(resetResult.content);
      setSelectedSkill(resetResult);
      setIsDirty(false);
      setNotification({ type: 'success', message: 'Skill reset to default' });
      // Refresh list
      const updated = await fetchSkills(selectedRepoId);
      setSkills(updated);
    } catch (err) {
      setNotification({ type: 'error', message: (err as Error).message });
    }
  }, [selectedRepoId, selectedSkill]);

  // Create new skill
  const handleCreate = useCallback(async () => {
    if (!selectedRepoId || !newSkillName.trim()) return;
    const name = newSkillName.trim().endsWith('.md')
      ? newSkillName.trim()
      : `${newSkillName.trim()}.md`;
    try {
      await createSkill(selectedRepoId, name, `# ${name.replace('.md', '')}\n\nAdd your coding guidelines here.\n`);
      setShowCreateDialog(false);
      setNewSkillName('');
      // Refresh and select new skill
      const updated = await fetchSkills(selectedRepoId);
      setSkills(updated);
      const newSkill = updated.find((s) => s.name === name);
      if (newSkill) handleSelectSkill(newSkill);
      setNotification({ type: 'success', message: `Skill "${name}" created` });
    } catch (err) {
      setNotification({ type: 'error', message: (err as Error).message });
    }
  }, [selectedRepoId, newSkillName, handleSelectSkill]);

  // Delete custom skill
  const handleDelete = useCallback(async (name: string) => {
    if (!selectedRepoId) return;
    if (!confirm(`Delete custom skill "${name}"?`)) return;
    try {
      await deleteSkill(selectedRepoId, name);
      const updated = await fetchSkills(selectedRepoId);
      setSkills(updated);
      if (selectedSkill?.name === name) {
        setSelectedSkill(null);
        setEditorContent('');
      }
      setNotification({ type: 'success', message: `Skill "${name}" deleted` });
    } catch (err) {
      setNotification({ type: 'error', message: (err as Error).message });
    }
  }, [selectedRepoId, selectedSkill]);

  // Separate built-in and custom skills
  const builtInSkills = skills.filter((s) => s.isDefault || s.isModified);
  const customSkills = skills.filter((s) => !s.isDefault && !s.isModified);

  // No repos empty state
  if (repos.length === 0) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center text-gray-500">
          <h2 className="text-xl font-semibold mb-2">No Repositories Connected</h2>
          <p>Connect a repository in Settings to start editing skills.</p>
        </div>
      </div>
    );
  }

  return (
    <div className="flex flex-col h-full">
      {/* Header with repo selector */}
      <div className="flex items-center gap-4 p-4 border-b border-gray-200">
        <h1 className="text-lg font-semibold">Skills Editor</h1>
        <select
          value={selectedRepoId}
          onChange={(e) => setSelectedRepoId(e.target.value)}
          className="border border-gray-300 rounded px-3 py-1.5 text-sm"
        >
          {repos.map((repo) => (
            <option key={repo.id} value={repo.id}>{repo.name}</option>
          ))}
        </select>
      </div>

      {/* Notification toast */}
      {notification && (
        <div className={`mx-4 mt-2 px-4 py-2 rounded text-sm ${
          notification.type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
        }`}>
          {notification.message}
          <button onClick={() => setNotification(null)} className="ml-2 font-bold">x</button>
        </div>
      )}

      {/* Main layout: sidebar + editor */}
      <div className="flex flex-1 min-h-0">
        {/* Sidebar */}
        <div className="w-64 border-r border-gray-200 overflow-y-auto p-3">
          {/* Built-in Skills */}
          <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">
            Built-in Skills
          </h3>
          <ul className="space-y-1 mb-4">
            {builtInSkills.map((skill) => (
              <li
                key={skill.name}
                className={`flex items-center justify-between px-2 py-1.5 rounded cursor-pointer text-sm ${
                  selectedSkill?.name === skill.name
                    ? 'bg-blue-100 text-blue-800'
                    : 'hover:bg-gray-100'
                }`}
                onClick={() => handleSelectSkill(skill)}
              >
                <span className="truncate">{skill.name}</span>
                {skill.isModified && (
                  <span className="w-2 h-2 bg-yellow-500 rounded-full flex-shrink-0" title="Modified" />
                )}
              </li>
            ))}
          </ul>

          {/* Custom Skills */}
          <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">
            Custom Skills
          </h3>
          <ul className="space-y-1 mb-4">
            {customSkills.map((skill) => (
              <li
                key={skill.name}
                className={`flex items-center justify-between px-2 py-1.5 rounded cursor-pointer text-sm ${
                  selectedSkill?.name === skill.name
                    ? 'bg-blue-100 text-blue-800'
                    : 'hover:bg-gray-100'
                }`}
                onClick={() => handleSelectSkill(skill)}
              >
                <span className="truncate">{skill.name}</span>
                <button
                  onClick={(e) => { e.stopPropagation(); handleDelete(skill.name); }}
                  className="text-red-400 hover:text-red-600 text-xs"
                  title="Delete"
                >
                  x
                </button>
              </li>
            ))}
            {customSkills.length === 0 && (
              <li className="text-xs text-gray-400 px-2">No custom skills yet</li>
            )}
          </ul>

          {/* Create button */}
          <button
            onClick={() => setShowCreateDialog(true)}
            className="w-full px-3 py-2 text-sm text-blue-600 border border-blue-300 rounded hover:bg-blue-50"
          >
            + Create New Skill
          </button>
        </div>

        {/* Editor area */}
        <div className="flex-1 flex flex-col min-w-0">
          {selectedSkill ? (
            <>
              {/* Skill name + action buttons */}
              <div className="flex items-center justify-between px-4 py-2 border-b border-gray-200">
                <div className="flex items-center gap-2">
                  <span className="font-medium text-sm">{selectedSkill.name}</span>
                  {isDirty && <span className="text-xs text-yellow-600">(unsaved changes)</span>}
                </div>
                <div className="flex gap-2">
                  {(selectedSkill.isDefault || selectedSkill.isModified) && (
                    <button
                      onClick={handleReset}
                      className="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50"
                    >
                      Reset to Default
                    </button>
                  )}
                  <button
                    onClick={handleSave}
                    disabled={!isDirty}
                    className="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
                  >
                    Save
                  </button>
                </div>
              </div>
              {/* Editor + Preview */}
              <div className="flex-1 min-h-0 p-4">
                <EditorWithPreview
                  value={editorContent}
                  onChange={handleEditorChange}
                  layout="tabbed"
                />
              </div>
            </>
          ) : (
            <div className="flex items-center justify-center h-full text-gray-400">
              Select a skill from the sidebar to start editing
            </div>
          )}
        </div>
      </div>

      {/* Create Skill Dialog */}
      {showCreateDialog && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg shadow-xl p-6 w-96">
            <h3 className="text-lg font-semibold mb-4">Create New Skill</h3>
            <input
              type="text"
              placeholder="skill-name.md"
              value={newSkillName}
              onChange={(e) => setNewSkillName(e.target.value)}
              onKeyDown={(e) => { if (e.key === 'Enter') handleCreate(); }}
              className="w-full border border-gray-300 rounded px-3 py-2 mb-4 text-sm"
              autoFocus
            />
            <div className="flex justify-end gap-2">
              <button
                onClick={() => { setShowCreateDialog(false); setNewSkillName(''); }}
                className="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                onClick={handleCreate}
                disabled={!newSkillName.trim()}
                className="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
              >
                Create
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default SkillsEditor;
```

**Step 3: Add the route in App.tsx**

In `src/client/App.tsx`, add a route for the Skills Editor:

```tsx
import { SkillsEditor } from './pages/SkillsEditor.js';

// Inside the router:
<Route path="/skills" element={<SkillsEditor />} />
```

Ensure the navigation bar includes a "Skills" link pointing to `/skills`.

### 3.3 API Contract

This page consumes the following APIs (defined in STORY-003-04):

| Action | Method | Endpoint | Purpose |
|--------|--------|----------|---------|
| Load repos | `GET` | `/api/repos` | Populate repo selector |
| List skills | `GET` | `/api/repos/:repoId/skills` | Load sidebar |
| Save skill | `PUT` | `/api/repos/:repoId/skills/:name` | Save edits |
| Create skill | `POST` | `/api/repos/:repoId/skills` | New custom skill |
| Delete skill | `DELETE` | `/api/repos/:repoId/skills/:name` | Remove custom skill |
| Reset skill | `POST` | `/api/repos/:repoId/skills/:name/reset` | Revert to default |

---

## 4. Definition of Done (The Gate)
- [ ] `src/client/pages/SkillsEditor.tsx` exists and renders a full Skills Editor page.
- [ ] Repo selector dropdown populates from connected repos.
- [ ] Sidebar lists skills in two groups: Built-in and Custom.
- [ ] Clicking a skill loads its content into the MarkdownEditor.
- [ ] Save button persists changes via `PUT` and shows a success notification.
- [ ] Reset button reverts to default template content.
- [ ] "+ Create New Skill" dialog creates a new skill and selects it.
- [ ] Custom skills can be deleted with confirmation.
- [ ] Modified indicator (yellow dot) shows for customized built-in skills.
- [ ] Preview tab renders markdown via FilePreview.
- [ ] Empty state displays when no repos are connected.
- [ ] Route is registered in `App.tsx` at `/skills`.
- [ ] API client functions added to `src/client/lib/api.ts`.
- [ ] TypeScript compiles with no errors (`npx tsc --noEmit`).
